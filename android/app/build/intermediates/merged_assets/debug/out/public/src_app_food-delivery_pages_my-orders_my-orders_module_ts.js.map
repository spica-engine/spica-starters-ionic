{"version":3,"sources":["./src/app/food-delivery/pages/my-orders/my-orders-routing.module.ts","./src/app/food-delivery/pages/my-orders/my-orders.module.ts","./src/app/food-delivery/pages/my-orders/my-orders.page.ts","./src/app/food-delivery/pages/my-orders/my-orders.page.scss","./src/app/food-delivery/pages/my-orders/my-orders.page.html"],"names":[],"mappings":"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","file":"src_app_food-delivery_pages_my-orders_my-orders_module_ts.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { MyOrdersPage } from './my-orders.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: MyOrdersPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class MyOrdersPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { MyOrdersPageRoutingModule } from './my-orders-routing.module';\n\nimport { MyOrdersPage } from './my-orders.page';\nimport { SpicaComponentsModule } from 'src/app/components/components.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    MyOrdersPageRoutingModule,\n    SpicaComponentsModule\n  ],\n  declarations: [MyOrdersPage]\n})\nexport class MyOrdersPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { AuthService } from '../../services/auth.service';\nimport { Order, order, User, food, rating, Rating } from '../../services/bucket';\n\n@Component({\n  selector: 'app-my-orders',\n  templateUrl: './my-orders.page.html',\n  styleUrls: ['./my-orders.page.scss'],\n})\nexport class MyOrdersPage implements OnInit {\n  user: User;\n  orders: any[] = [];\n  selectedOrder: string;\n  isLoading: boolean = true;\n  constructor(private _authService: AuthService) {\n    this._authService.initBucket();\n  }\n\n  async ngOnInit() {\n    this.user = await this._authService.getUser().toPromise();\n    this.orders = await this.getMyOrders();\n    this.orders.forEach((el) => {\n      let maxDate = new Date();\n      maxDate.setDate(maxDate.getDate() - 2);\n      if (new Date(el.created_at) > maxDate) {\n        el['can_rate'] = true;\n      }\n      this.isLoading = false;\n    });\n  }\n\n  getMyOrders() {\n    return order.getAll({ queryParams: { filter: { user: this.user._id }, relation: true, sort: {_id: -1} }, });\n  }\n\n  async ratingAction(event) {\n    if (event.data.value == 'apply') {\n      this.isLoading = true;\n      let selectedOrder = this.orders.find((el) => {\n        return el._id == this.selectedOrder;\n      });\n      let ratingData = {\n        user: this.user._id,\n        rating: event.data.rating,\n        comment: event.data.comment,\n      };\n\n      let orderIndex = this.orders.findIndex(el => el._id == selectedOrder._id)\n      this.orders[orderIndex]['rating'] = ratingData;\n      \n      let newRating = await rating.insert(ratingData);\n      \n      order.patch({_id: selectedOrder._id, rating: newRating._id})\n      \n      for (const el of selectedOrder.foods) {\n        let tempFood = await food.get(el._id);\n        tempFood.ratings = tempFood.ratings || [];\n        tempFood.ratings.push(newRating._id);\n        food.patch({ _id: tempFood._id, ratings: tempFood.ratings });\n      }\n      this.isLoading = false;\n    }\n    this.selectedOrder = undefined;\n  }\n}\n","export default \":host .orders-container ion-card .card-content {\\n  padding: 15px;\\n}\\n:host .orders-container ion-card .status {\\n  background: #dddddd;\\n  padding: 15px;\\n  margin: 0;\\n  color: black;\\n  font-weight: 700;\\n}\\n:host .orders-container ion-card p span {\\n  color: black;\\n}\\n:host .orders-container ion-card p.cannot-rate-text {\\n  font-size: 12px;\\n  color: #aa0000;\\n}\\n:host .orders-container ion-card p.user-rate {\\n  display: flex;\\n  align-items: center;\\n}\\n:host .orders-container ion-card p.user-rate ion-icon {\\n  margin-right: 3px;\\n  margin-left: 5px;\\n  color: #ffc400;\\n}\\n:host .orders-container ion-card .button-label {\\n  display: flex;\\n  justify-content: flex-end;\\n}\\n:host .orders-container ion-card .button-label ion-button {\\n  height: 30px;\\n  width: 50px;\\n  font-size: 12px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm15LW9yZGVycy5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR007RUFDRSxhQUFBO0FBRlI7QUFLTTtFQUNFLG1CQUFBO0VBQ0EsYUFBQTtFQUNBLFNBQUE7RUFDQSxZQUFBO0VBQ0EsZ0JBQUE7QUFIUjtBQU1RO0VBQ0UsWUFBQTtBQUpWO0FBTVE7RUFDRSxlQUFBO0VBQ0EsY0FBQTtBQUpWO0FBTVE7RUFDRSxhQUFBO0VBQ0EsbUJBQUE7QUFKVjtBQUtVO0VBQ0UsaUJBQUE7RUFDQSxnQkFBQTtFQUNBLGNBQUE7QUFIWjtBQVFNO0VBQ0UsYUFBQTtFQUNBLHlCQUFBO0FBTlI7QUFPUTtFQUNFLFlBQUE7RUFDQSxXQUFBO0VBQ0EsZUFBQTtBQUxWIiwiZmlsZSI6Im15LW9yZGVycy5wYWdlLnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyI6aG9zdCB7XG4gIC5vcmRlcnMtY29udGFpbmVyIHtcbiAgICBpb24tY2FyZCB7XG4gICAgICAuY2FyZC1jb250ZW50IHtcbiAgICAgICAgcGFkZGluZzogMTVweDtcbiAgICAgIH1cblxuICAgICAgLnN0YXR1cyB7XG4gICAgICAgIGJhY2tncm91bmQ6IHJnYigyMjEsIDIyMSwgMjIxKTtcbiAgICAgICAgcGFkZGluZzogMTVweDtcbiAgICAgICAgbWFyZ2luOiAwO1xuICAgICAgICBjb2xvcjogYmxhY2s7XG4gICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7XG4gICAgICB9XG4gICAgICBwIHtcbiAgICAgICAgc3BhbiB7XG4gICAgICAgICAgY29sb3I6IGJsYWNrO1xuICAgICAgICB9XG4gICAgICAgICYuY2Fubm90LXJhdGUtdGV4dCB7XG4gICAgICAgICAgZm9udC1zaXplOiAxMnB4O1xuICAgICAgICAgIGNvbG9yOiByZ2IoMTcwLCAwLCAwKTtcbiAgICAgICAgfVxuICAgICAgICAmLnVzZXItcmF0ZXtcbiAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICAgICAgaW9uLWljb257XG4gICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDNweDtcbiAgICAgICAgICAgIG1hcmdpbi1sZWZ0OiA1cHg7XG4gICAgICAgICAgICBjb2xvcjogcmdiKDI1NSwgMTk2LCAwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLmJ1dHRvbi1sYWJlbCB7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgIGp1c3RpZnktY29udGVudDogZmxleC1lbmQ7XG4gICAgICAgIGlvbi1idXR0b24ge1xuICAgICAgICAgIGhlaWdodDogMzBweDtcbiAgICAgICAgICB3aWR0aDogNTBweDtcbiAgICAgICAgICBmb250LXNpemU6IDEycHg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ== */\";","export default \"<ion-header mode=\\\"ios\\\">\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button></ion-back-button>\\n    </ion-buttons>\\n    <ion-title>My Orders</ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n  <div class=\\\"orders-container\\\" *ngIf=\\\"orders.length && !isLoading\\\">\\n    <ion-card *ngFor=\\\"let order of orders\\\">\\n      <p class=\\\"status\\\">Status: {{order.status}}</p>\\n      <div class=\\\"card-content\\\">\\n        <ion-label>\\n          <ion-text *ngFor=\\\"let food of order.foods\\\">\\n            {{food.count + ' ' + food.name}}\\n          </ion-text>\\n        </ion-label>\\n        <p><span>Total:</span> {{order.price}}$</p>\\n        <p><span>Date:</span> {{order.created_at | date:'dd-MM-yyyy HH:MM'}}</p>\\n        <p *ngIf=\\\"!order['can_rate'] && !order.rating\\\" class=\\\"cannot-rate-text\\\">\\n          You cannot rate because more than 2 days have passed since your order.\\n        </p>\\n        <ion-label *ngIf=\\\"order['can_rate'] && !order.rating\\\" class=\\\"button-label\\\"\\n          ><ion-button (click)=\\\"selectedOrder=order._id; \\\">Rate</ion-button></ion-label\\n        >\\n        <p class=\\\"user-rate\\\" *ngIf=\\\"order.rating\\\"><span>Rated: </span> <ion-icon name=\\\"star\\\"></ion-icon>{{order.rating?.rating}}</p>\\n      </div>\\n    </ion-card>\\n  </div>\\n</ion-content>\\n<ion-spinner\\n  *ngIf=\\\"isLoading\\\"\\n  class=\\\"spinner-center-page\\\"\\n  name=\\\"crescent\\\"\\n></ion-spinner>\\n<spica-rating *ngIf=\\\"selectedOrder && !isLoading\\\" title=\\\"Rate Food\\\" (action)=\\\"ratingAction($event)\\\"></spica-rating>\";"],"sourceRoot":"webpack:///"}