{"version":3,"sources":["./src/app/appointment/pages/appointments/appointments-routing.module.ts","./src/app/appointment/pages/appointments/appointments.module.ts","./src/app/appointment/pages/appointments/appointments.page.ts","./src/app/appointment/pages/appointments/appointments.page.scss","./src/app/appointment/pages/appointments/appointments.page.html"],"names":[],"mappings":"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","file":"src_app_appointment_pages_appointments_appointments_module_ts.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { AppointmentsPage } from './appointments.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: AppointmentsPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class AppointmentsPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { AppointmentsPageRoutingModule } from './appointments-routing.module';\n\nimport { AppointmentsPage } from './appointments.page';\nimport { AppointmentComponentModule } from '../../components/appointment-components.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    AppointmentsPageRoutingModule,\n    AppointmentComponentModule\n  ],\n  declarations: [AppointmentsPage]\n})\nexport class AppointmentsPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { ModalController } from '@ionic/angular';\nimport { CreateAppointmentComponent } from '../../components/create-appointment/create-appointment.component';\nimport { AuthService } from '../../services/auth.service';\nimport * as DataService from '../../services/bucket';\n\n@Component({\n  selector: 'app-appointments',\n  templateUrl: './appointments.page.html',\n  styleUrls: ['./appointments.page.scss'],\n})\nexport class AppointmentsPage {\n  screen: string = 'coming';\n  user: DataService.Employee;\n  appointments: DataService.Appointment[] = [];\n  eventSource: any[] = [];\n  currentAppointments: any = [];\n  loading: boolean = true;\n\n  constructor(\n    private _authService: AuthService,\n    private _modalController: ModalController\n  ) {}\n\n  async ionViewWillEnter() {\n    this.user = await this._authService.getUser().toPromise();\n    if (this.user) {\n      await this.getAppointments();\n      this.prepareAppointments();\n    }\n  }\n\n  async getAppointments() {\n    this.appointments = await DataService.appointment.getAll({\n      queryParams: { filter: { employee: this.user._id }, relation: true },\n    });\n  }\n\n  prepareAppointments() {\n    this.eventSource = [];\n    this.appointments?.forEach((appointment) => {\n      if (appointment.client) {\n        this.eventSource.push({\n          title: `${appointment.client['name']} ${appointment.client['surname']}`,\n          startTime: new Date(appointment.from),\n          endTime: new Date(appointment.from),\n          allDay: false,\n          _id: appointment._id,\n        });\n      }\n    });\n\n    this.loading = false;\n  }\n\n  onTimeSelected(events) {\n    if (!events.length) {\n      this.currentAppointments = [];\n      return;\n    }\n    const appointmentIds = [];\n    events.forEach((el) => {\n      appointmentIds.push(el._id);\n    });\n\n    this.currentAppointments = this.appointments.filter((el) => {\n      if (appointmentIds.includes(el._id)) {\n        return el;\n      }\n    });\n  }\n\n  async appointmentDetailsModal(appointment) {\n    const modal = await this._modalController.create({\n      component: CreateAppointmentComponent,\n      componentProps: {\n        action: 'update',\n        appointment: appointment,\n      },\n    });\n\n    modal.onWillDismiss().then(async (res) => {\n      if (!res.data || res.data.value == 'close') {\n        return;\n      } else if (res.data.action == 'update') {\n        await this.updateClient(res.data.appointmentData.client);\n        this.updateAppointment(res.data.appointmentData);\n      } else if (res.data.action == 'delete') {\n        this.deleteAppointment(res.data.appointmentData._id);\n      }\n      \n    });\n\n    return await modal.present();\n  }\n\n  async updateClient(client) {\n    await DataService.client.patch(client);\n  }\n\n  async updateAppointment(appointment) {\n    let currentAppointment = JSON.parse(JSON.stringify(appointment));\n    await DataService.appointment.patch(appointment);\n\n    let appointmentIndex = this.appointments.findIndex(\n      (el) => el._id == currentAppointment._id\n    );\n    this.appointments[appointmentIndex] = currentAppointment;\n    this.prepareAppointments();\n  }\n\n  deleteAppointment(id) {\n    DataService.appointment.remove(id).then((_) => {\n      this.appointments = this.appointments.filter((el) => {\n        return el._id !== id;\n      });\n      this.prepareAppointments();\n    });\n  }\n}\n","export default \":host .logo {\\n  align-items: center;\\n  display: flex;\\n  color: var(--cd-logo-color);\\n  font-weight: bold;\\n}\\n:host .logo ion-icon {\\n  padding-right: 10px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcG9pbnRtZW50cy5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0U7RUFDRSxtQkFBQTtFQUNBLGFBQUE7RUFDQSwyQkFBQTtFQUNBLGlCQUFBO0FBQUo7QUFDSTtFQUNFLG1CQUFBO0FBQ04iLCJmaWxlIjoiYXBwb2ludG1lbnRzLnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIjpob3N0IHtcbiAgLmxvZ28ge1xuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBjb2xvcjogdmFyKC0tY2QtbG9nby1jb2xvcik7XG4gICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgaW9uLWljb24ge1xuICAgICAgcGFkZGluZy1yaWdodDogMTBweDtcbiAgICB9XG4gIH1cbn1cbiJdfQ== */\";","export default \"<ion-header mode=\\\"ios\\\">\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <div class=\\\"logo\\\">\\n        <ion-icon name=\\\"logo-ionic\\\"></ion-icon>\\n        Appointments\\n      </div>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n  <custom-calendar *ngIf=\\\"!loading\\\" (timeselected)=\\\"onTimeSelected($event.events)\\\"  [eventSource]=\\\"eventSource\\\"></custom-calendar>\\n  <div class=\\\"container\\\" *ngIf=\\\"eventSource && eventSource.length && currentAppointments.length\\\">\\n    <appointment-card [appointment]=\\\"appointment\\\" *ngFor=\\\"let appointment of currentAppointments\\\" (click)=\\\"appointmentDetailsModal(appointment)\\\">\\n    </appointment-card>\\n  </div>\\n</ion-content>\\n\";"],"sourceRoot":"webpack:///"}